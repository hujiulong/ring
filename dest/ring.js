var Ring=new function(){function e(e){n(e,"fonts/Script_MT_Bold_Regular.json","models/o.js",t)}function n(e,n,t,o){var i,r=new THREE.FontLoader,a=new THREE.JSONLoader;r.load(n,function(n){i=n,a.load(t,function(n,t){o(e,i,n)})})}function t(e,n,t){H=a(e,n),x=i(t)}function o(){w=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,1e4),w.position.set(0,0,2e3),p=new THREE.TrackballControls(w,u),p.rotateSpeed=2,p.noZoom=!1,p.zoomSpeed=1.2,p.staticMoving=!0,T=new THREE.Scene,light=new THREE.DirectionalLight(16777215),light.position.set(0,100,200),T.add(light),light=new THREE.DirectionalLight(16777215),light.position.set(0,-100,-200),T.add(light),R=new THREE.WebGLRenderer({antialias:!0}),R.setClearColor(16777215),R.setSize(window.innerWidth,window.innerHeight),u=document.getElementById("container"),u.appendChild(R.domElement),m=new Stats,m.domElement.style.position="absolute",m.domElement.style.top="0px",m.domElement.style.zIndex=100,u.appendChild(m.domElement);var e=new THREE.JSONLoader;e.load("models/o.js",function(e,n){console.log((new Date).getTime()-h+"ms")}),window.addEventListener("resize",E,!1)}function i(e){function n(e,n,t){return e.distanceToPoint(t)>0&&n.distanceToPoint(t)>0}console.log(e);var t,o=new THREE.Vector3,i=[],r=[],a=[],s=[],l=(new THREE.Matrix4).makeRotationX(-Math.PI/2).multiply((new THREE.Matrix4).makeScale(50,50,50));e.applyMatrix(l),e.verticesNeedUpdate=!0,e.computeBoundingBox(),t=(e.boundingBox.max.x-e.boundingBox.min.x)/2,o.set(0,0,t+e.boundingBox.min.z);var E=(H.width/2-7)/(t+H.depth/2),g=(new THREE.Vector3).crossVectors(new THREE.Vector3(0,0,1).applyAxisAngle(new THREE.Vector3(0,1,0),E).normalize(),new THREE.Vector3(0,1,1).applyAxisAngle(new THREE.Vector3(0,1,0),E).normalize()),d=(new THREE.Vector3).crossVectors(new THREE.Vector3(0,0,1).applyAxisAngle(new THREE.Vector3(0,1,0),-E).normalize(),new THREE.Vector3(0,1,1).applyAxisAngle(new THREE.Vector3(0,1,0),-E).normalize()),h=new THREE.Plane;h.setFromNormalAndCoplanarPoint(g.normalize(),o);var u=new THREE.Plane;u.setFromNormalAndCoplanarPoint(d.normalize().negate(),o);for(var m=0;m<e.faces.length;m++){var w=e.faces[m],p=e.vertices[w.a],R=e.vertices[w.b],f=e.vertices[w.c],y=[p,R,f],b=[0,0,0],B=[],M=[];n(h,u,p)&&(b[0]=1),n(h,u,R)&&(b[1]=1),n(h,u,f)&&(b[2]=1);for(var z=0;z<b.length;z++)b[z]?M.push(y[z]):B.push(y[z]);if(0==M.length)i.push(p,R,f),r.push(new THREE.Face3(i.length-1,i.length-2,i.length-3));else if(1==M.length){var L,V,P=new THREE.Line3(M[0],B[0]),S=new THREE.Line3(M[0],B[1]),A=1,F=1;void 0!=(L=h.intersectLine(P))?A=1:(L=u.intersectLine(P),A=2),void 0!=(V=h.intersectLine(S))?F=1:(V=u.intersectLine(S),F=2),i.push(B[0],B[1],L,V),r.push(new THREE.Face3(i.length-1,i.length-3,i.length-4)),r.push(new THREE.Face3(i.length-2,i.length-3,i.length-4)),r.push(new THREE.Face3(i.length-1,i.length-2,i.length-4)),1==A?a.push(i.length-2):s.push(i.length-2),1==F?a.push(i.length-1):s.push(i.length-1)}else if(2==M.length){var L,V,P=new THREE.Line3(B[0],M[0]),S=new THREE.Line3(B[0],M[1]),A=1,F=1;void 0!=(L=h.intersectLine(P))?A=1:(L=u.intersectLine(P),A=2),void 0!=(V=h.intersectLine(S))?F=1:(V=u.intersectLine(S),F=2),i.push(B[0],L,V),r.push(new THREE.Face3(i.length-1,i.length-2,i.length-3)),1==A?a.push(i.length-2):s.push(i.length-2),1==F?a.push(i.length-1):s.push(i.length-1)}}for(var m=2;m<a.length;m++)r.push(new THREE.Face3(a[0],a[m],a[m-1]));for(var m=2;m<s.length;m++)r.push(new THREE.Face3(s[0],s[m],s[m-1]));var C=new THREE.Geometry;C.vertices=i,C.faces=r,C.computeFaceNormals(),x=new THREE.Mesh(C,v),T.add(x),H=c(o,t,H),H.position.y=-70,H.position.x+=5,T.add(H)}function r(e){return e>="A"&&e<="Z"||"p"==e||"s"==e||"1"==e}function a(e,n){for(var t,o=0,i=0,a=0;a<e.length;a++)r(e[a])||a==e.length-1?(i&&(i=0,t=l(t,e.substring(o,a),n)),t=l(t,e[a],n)):i||(i=1,o=a);return t.geometry.computeBoundingBox(),t.width=t.geometry.boundingBox.max.x-t.geometry.boundingBox.min.x,t.height=t.geometry.boundingBox.max.y-t.geometry.boundingBox.min.y,t.depth=t.geometry.boundingBox.max.z-t.geometry.boundingBox.min.z,t}function s(e,n){return new THREE.TextGeometry(e,{size:158,height:70,curveSegments:4,font:n,weight:"bold",style:"normal",bevelEnabled:!0,bevelThickness:2,bevelSize:1})}function l(e,n,t){if(void 0===e)return new THREE.Mesh(s(n,t),v);e.geometry.computeBoundingBox();var o=e.geometry.clone(),i=s(n,t);o.computeBoundingBox(),i.computeBoundingBox();var r=o.boundingBox.max.x-o.boundingBox.min.x,a=i.boundingBox.max.x-o.boundingBox.min.x,l=i.boundingBox.max.y-o.boundingBox.min.y,c=!1,E=new THREE.Vector3(r,0,0);do{for(var g=E.clone().add(new THREE.Vector3(a/2,l/2,0)),d=0;d<i.vertices.length;d++)if(!(i.vertices[d].z!=g.z||i.vertices[d].x>=a/2)){var h=i.vertices[d].clone(),u=h.sub(new THREE.Vector3(a/2,l/2,0)),m=new THREE.Raycaster(g,u.clone().normalize()),w=m.intersectObject(e);if(w.length>0&&w[0].distance<u.length()){c=!0,o.merge(i,(new THREE.Matrix4).setPosition(E));break}}E.x-=3}while(!c);return new THREE.Mesh(o,v)}function c(e,n,t){var o=(new THREE.Matrix4).setPosition(new THREE.Vector3(-t.width/2,0,0));t.geometry.applyMatrix(o);for(var i=n+t.depth/2,r=2*i*Math.PI,a=0;a<t.geometry.vertices.length;a++){var s=t.geometry.vertices[a],l=n-s.z,c=s.x,E=c/r*Math.PI*2;t.geometry.vertices[a].set(l*Math.sin(E),s.y,l*Math.cos(E)).add(e)}return t.geometry.verticesNeedUpdate=!0,t}function E(){w.aspect=window.innerWidth/window.innerHeight,w.updateProjectionMatrix(),R.setSize(window.innerWidth,window.innerHeight)}function g(){requestAnimationFrame(g),d()}function d(){m.update(),p.update(),R.render(T,w)}var h=(new Date).getTime();Detector.webgl||Detector.addGetWebGLMessage();var u,m,w,p,T,R,H,x,v=(new THREE.MeshPhongMaterial({color:16764482}),new THREE.MeshPhongMaterial({color:16764482,specular:3355443,combine:THREE.MixOperation,shininess:40,reflectivity:.55,side:THREE.DoubleSide}));new THREE.Projector;return o(),g(),{build:function(n){return n.length>10?void alert("文字太长"):void e(n)}}};